<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Avatar Selector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #F1F2EF;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        h2 {
            color: #0077cc;
            font-size: 24px;
            margin-bottom: 10px;
        }
        p {
            font-size: 16px;
            line-height: 1.5;
        }
        #profile-options {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        .profile-option {
            width: 100px;
            height: 100px;
            border: 2px solid transparent;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            cursor: pointer;
            transition: transform 0.3s ease, border-color 0.3s ease;
            padding: 0;
            outline: none;
            border: none;
        }
        .profile-option:focus,
        .profile-option:hover {
            transform: scale(1.1);
            border: 2px solid #0077cc;
        }
        .add-profile-link {
            display: block;
            text-align: center;
            color: #0077cc;
            font-size: 16px;
            text-decoration: underline;
            margin-top: 20px;
        }
        .confirmation {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            padding: 25px;
            background: #f1f2ef;
            border-radius: 8px;
        }
        .confirmation img {
            width: 100px;
            height: 100px;
        }
        .confirmation h3 {
            color: #000054;
            font-size: 22px;
            font-weight: 500;
            text-align: center;
            margin-bottom: 16px;
        }
        .confirmation-buttons {
            display: flex;
            gap: 24px;
        }
        .confirmation-button {
            width: 180px;
            padding: 12px 24px;
            border-radius: 8px;
            text-align: center;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }
        .confirmation-button:focus {
            outline: 2px solid #0056b3;
        }
        .cancel-button {
            background: #000054;
            color: white;
        }
        .add-button {
            background: #e61e2a;
            color: white;
        }

        .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #0077cc;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
        margin-right: 8px;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }

    .loading-message {
        display: flex;
        align-items: center;
        font-size: 16px;
        color: #0077cc;
        text-align: center;
        margin-top: 20px;
    }
    </style>
</head>
<body>
    <!-- Avatar Selection Screen -->
    <div id="avatar-selection">
        <h2>Select a RMIT Avatar</h2>
        <p>We know choosing the perfect profile picture can be tough! In the meantime, why not pick one of our RMIT-themed images to add some flair to your profile.</p>
        <div id="profile-options">
            <button 
                class="profile-option" 
                style="background-image: url('/imgs/profile_happy.png');" 
                data-src="/imgs/profile_happy.png" 
                data-alt="Happy Face" 
                aria-label="Happy Face">
            </button>
            <button 
                class="profile-option" 
                style="background-image: url('/imgs/profile_glide.png');" 
                data-src="/imgs/profile_glide.png" 
                data-alt="Glide Face" 
                aria-label="Glide Face">
            </button>
            <button 
                class="profile-option" 
                style="background-image: url('/imgs/profile_cheery.png');" 
                data-src="/imgs/profile_cheery.png" 
                data-alt="Cheery Face" 
                aria-label="Cheery Face">
            </button>
            <button 
                class="profile-option" 
                style="background-image: url('/imgs/profile_glasses.png');" 
                data-src="/imgs/profile_glasses.png" 
                data-alt="Glasses Face" 
                aria-label="Glasses Face">
            </button>
            <button 
                class="profile-option" 
                style="background-image: url('/imgs/profile_cat.png');" 
                data-src="/imgs/profile_cat.png" 
                data-alt="Cat Face" 
                aria-label="Cat Face">
            </button>
            <button 
                class="profile-option" 
                style="background-image: url('/imgs/profile_skull.png');" 
                data-src="/imgs/profile_skull.png" 
                data-alt="Skull Face" 
                aria-label="Skull Face">
            </button>
            <button 
                class="profile-option" 
                style="background-image: url('/imgs/profile_bot.png');" 
                data-src="/imgs/profile_bot.png" 
                data-alt="Bot Face" 
                aria-label="Bot Face">
            </button>
            <button 
                class="profile-option" 
                style="background-image: url('/imgs/profile_bball.png');" 
                data-src="/imgs/profile_bball.png" 
                data-alt="Basketball Face" 
                aria-label="Basketball Face">
            </button>
            <button 
                class="profile-option" 
                style="background-image: url('/imgs/profile_dog.png');" 
                data-src="/imgs/profile_dog.png" 
                data-alt="Dog Face" 
                aria-label="Dog Face">
            </button>
            <button 
                class="profile-option" 
                style="background-image: url('/imgs/profile_dots.png');" 
                data-src="/imgs/profile_dots.png" 
                data-alt="Dotted Eye Face" 
                aria-label="Dotted Eye Face">
            </button>
            <button 
                class="profile-option" 
                style="background-image: url('/imgs/profile_read.png');" 
                data-src="/imgs/profile_read.png" 
                data-alt="Reading Face" 
                aria-label="Reading Face">
            </button>
        </div>
        <a href="https://rmit.instructure.com/profile" class="add-profile-link" target="_blank">Or add your own profile picture</a>
    </div>

    <!-- Confirmation Dialog -->
    <div id="confirmation" class="confirmation">
        <img id="selected-avatar" src="" alt="Selected Avatar">
        <h3>Are you sure you want to make this image your profile picture?</h3>
        <div class="confirmation-buttons">
            <button class="confirmation-button cancel-button">Cancel</button>
            <button class="confirmation-button add-button">Add to profile</button>
        </div>
    </div>

    <script>
        const avatarSelection = document.getElementById('avatar-selection');
        const confirmation = document.getElementById('confirmation');
        const selectedAvatar = document.getElementById('selected-avatar');
        const cancelButton = document.querySelector('.cancel-button');
        const addButton = document.querySelector('.add-button');

      // Show confirmation dialog
document.querySelectorAll('.profile-option').forEach(button => {
    button.addEventListener('click', () => {
        selectedAvatar.src = button.getAttribute('data-src'); // Fetch the correct avatar image URL
        selectedAvatar.alt = button.getAttribute('data-alt'); // Fetch the correct alt text
        avatarSelection.style.display = 'none';
        confirmation.style.display = 'flex';
    });
});

        // Cancel button action
        cancelButton.addEventListener('click', () => {
            confirmation.style.display = 'none';
            avatarSelection.style.display = 'block';
        });

     // Add to profile action with loading effect
addButton.addEventListener('click', async () => {
    const imageUrl = selectedAvatar.src; // Get the selected image URL

    // Show loading message
    confirmation.innerHTML = `
        <div class="loading-message">
            <div class="spinner"></div>
            Uploading your profile picture, please wait...
        </div>`;

    try {
        const response = await fetch('/api/upload-profile-picture', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ imageUrl }),
        });

        const result = await response.json();
        if (response.ok) {
            confirmation.innerHTML = `
                <p style="color: #0077cc; font-size: 16px; text-align: center; margin-top: 20px;">
                    ${result.message || 'Your profile picture has been successfully updated!'}
                </p>`;
        } else {
            throw new Error(result.error || 'An error occurred');
        }
    } catch (error) {
        confirmation.innerHTML = `
            <p style="color: red; font-size: 16px; text-align: center; margin-top: 20px;">
                Failed to update profile picture. Please try again.
            </p>`;
        console.error('Error updating profile picture:', error);
    }
});
    </script>
</body>
</html>