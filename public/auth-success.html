<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Authentication Successful</title>
    <script>
        window.onload = () => {
            const message = { type: 'authSuccess' };
            let attempts = 0;
            let maxAttempts = 10;
            let intervalMs = 300;
            let messageSent = false;

            const sendMessage = () => {
                attempts++;
                try {
                    if (window.opener && !window.opener.closed) {
                        console.log('Posting message to opener...');
                        window.opener.postMessage(message, '*');
                        messageSent = true;
                    } else if (window.parent !== window) {
                        console.log('Posting message to parent...');
                        window.parent.postMessage(message, '*');
                        messageSent = true;
                    }
                } catch (err) {
                    console.warn('Failed to postMessage:', err);
                }

                if (messageSent || attempts >= maxAttempts) {
                    clearInterval(intervalId);
                    if (window.opener) {
                        setTimeout(() => window.close(), 500);
                    }
                    document.getElementById('message').textContent = messageSent
                        ? 'Authentication complete. You can close this tab.'
                        : 'Authentication complete. You may return to the original window.';
                }
            };

            const intervalId = setInterval(sendMessage, intervalMs);
        };
    </script>
</head>
<body style="font-family: sans-serif; text-align: center; padding: 50px;">
    <h2 id="message">Completing authenticationâ€¦</h2>
</body>
</html>